{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h3>Chat with Assistant</h3>
  <div id="chatBox" style="border:1px solid #ccc; padding:10px; height:350px; overflow-y:auto;"></div>
  <div class="input-group mt-2">
    <input type="text" id="chatInput" class="form-control" placeholder="Type your message...">
    <button id="chatSend" class="btn btn-primary">Send</button>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById("chatSend").addEventListener("click", function () {
  const input = document.getElementById("chatInput");
  const msg = input.value.trim();
  if (!msg) return;

  const box = document.getElementById("chatBox");
  box.innerHTML += `<p><strong>You:</strong> ${msg}</p>`;
  input.value = "";

  fetch("/chatbot/reply/", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message: msg })
  })
  .then(res => res.json())
  .then(data => {
  let formatted = data.reply
    .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")  // Convert **bold**
    .replace(/\n/g, "<br>");  // Convert line breaks

  box.innerHTML += `<p><strong>Bot:</strong><br>${formatted}</p>`;
  box.scrollTop = box.scrollHeight;
})

  .catch(() => {
    box.innerHTML += `<p><strong>Error:</strong> Unable to reach chatbot.</p>`;
  });
});
</script>
{% endblock %}
